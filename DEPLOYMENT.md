# Инструкция по деплою на TimeWeb Cloud Apps

## Важно! О файле app.yml

**TimeWeb Cloud Apps НЕ использует файл app.yml!**

Файл `app.yml` был удалён из проекта, так как TimeWeb Cloud Apps автоматически определяет тип проекта и настраивает всё сама. Наличие этого файла может вызывать конфликты при деплое.

## Требования

- Node.js 18.x или выше
- npm или yarn
- Аккаунт TimeWeb Cloud
- GitHub/GitLab/Bitbucket репозиторий

## Подготовка к деплою

### 1. Локальная проверка

```bash
# Установка зависимостей
npm ci

# Сборка проекта
npm run build

# Проверка сборки
npm run preview
```

Убедитесь, что сборка проходит без ошибок!

### 2. Настройка в TimeWeb Cloud Apps

#### Создание приложения

1. Войдите в [панель управления TimeWeb Cloud](https://timeweb.cloud/my)
2. Перейдите в раздел **"Apps"**
3. Нажмите **"Создать приложение"**

#### Выбор типа

В пункте "Тип" выберите **"React"** или **"Other JS Framework"**

TimeWeb автоматически настроит окружение для React/Vite приложений.

#### Подключение репозитория

Подключите ваш Git репозиторий:
- **GitHub** - авторизуйтесь и выберите репозиторий
- **GitLab** - авторизуйтесь и выберите репозиторий
- **Bitbucket** - авторизуйтесь и выберите репозиторий
- **По URL** - укажите прямую ссылку на репозиторий

### 3. Конфигурация приложения

TimeWeb Cloud Apps определит настройки автоматически, но проверьте:

**Команда сборки:**
```bash
npm ci && npm run build
```

**Директория сборки:**
```
dist
```

**Регион:**
- Выберите наиболее подходящий регион (Москва, Санкт-Петербург, и т.д.)

**Автодеплой:**
- ✅ Рекомендуется включить "Сборка по последнему выполненному коммиту"
- Приложение будет автоматически обновляться при новых коммитах

### 4. Что делает TimeWeb автоматически

После запуска деплоя TimeWeb Cloud Apps автоматически:

1. ✅ Клонирует репозиторий
2. ✅ Устанавливает зависимости (`npm ci`)
3. ✅ Собирает проект (`npm run build`)
4. ✅ Настраивает Nginx для SPA
5. ✅ Настраивает роутинг (все маршруты -> index.html)
6. ✅ Применяет кэширование для статических файлов
7. ✅ Выпускает SSL-сертификат
8. ✅ Настраивает технический домен

**Никакие дополнительные файлы конфигурации не требуются!**

### 5. Переменные окружения (опционально)

Если приложению нужны переменные окружения:

1. В настройках приложения откройте раздел "Переменные"
2. Добавьте переменные в формате `KEY=value`
3. Для Vite все переменные должны начинаться с `VITE_`

Пример:
```
VITE_API_URL=https://api.example.com
VITE_APP_NAME=My App
```

4. Пересоберите приложение после добавления переменных

## Проверка после деплоя

После успешного деплоя проверьте:

- ✅ Статус приложения "Running" или "Активно"
- ✅ Главная страница загружается по техническому домену
- ✅ Навигация между страницами работает (React Router)
- ✅ Изображения и статические файлы загружаются
- ✅ Переключение языков функционирует (i18n)
- ✅ SSL-сертификат активен (https://)
- ✅ Мобильная версия отображается корректно

## Устранение проблем

### Ошибка "ERROR | Deploy error"

Это наиболее частая ошибка. Причины и решения:

**1. Проблема с конфигурацией (решено)**
- ❌ Был файл app.yml, который конфликтовал
- ✅ Файл удалён - TimeWeb настроит всё автоматически

**2. Ошибки в коде**
```bash
# Проверьте локально:
npm ci
npm run build
```
- Если локально не собирается - исправьте ошибки в коде
- Посмотрите логи сборки в TimeWeb для деталей

**3. Неправильная директория сборки**
- Убедитесь, что указана директория `dist`
- Проверьте, что после `npm run build` файлы попадают в `dist/`

**4. Проблемы с зависимостями**
- Убедитесь, что все зависимости указаны в `package.json`
- Проверьте совместимость версий пакетов

### 404 при переходе по прямым ссылкам

Если при прямом переходе на `/about` или другие роуты появляется 404:

**Причина:** Неправильная настройка SPA роутинга

**Решение:**
- TimeWeb должен настроить это автоматически для типа "React"
- Если проблема сохраняется - обратитесь в поддержку TimeWeb
- Убедитесь, что выбран правильный тип приложения при создании

### Не загружаются изображения/статика

**Проверьте:**

1. Путь к файлам в коде:
```tsx
// ✅ Правильно
import heroImage from "@/assets/hero.jpg";

// ❌ Неправильно (для src/assets)
<img src="/assets/hero.jpg" />
```

2. Содержимое dist/ после сборки:
```bash
npm run build
ls -la dist/
```

3. Импорты в коде - все изображения должны быть импортированы

### Логи не помогают

Если логи в TimeWeb не дают чёткой информации:

1. Склонируйте репозиторий на чистую машину
2. Выполните точно те же команды что и TimeWeb:
```bash
npm ci
npm run build
```
3. Проверьте результат сборки
4. Если локально работает - обратитесь в поддержку TimeWeb

## Подключение собственного домена

Чтобы подключить свой домен к приложению:

### Шаг 1: Добавьте домен

1. В настройках приложения откройте раздел "Домены"
2. Нажмите "Добавить домен"
3. Введите ваш домен (например, `myapp.com` или `www.myapp.com`)

### Шаг 2: Настройте DNS

TimeWeb покажет необходимые DNS записи:

**Для корневого домена (myapp.com):**
```
Тип: A
Имя: @
Значение: [IP-адрес от TimeWeb]
```

**Для поддомена (www.myapp.com):**
```
Тип: CNAME
Имя: www
Значение: [домен от TimeWeb]
```

### Шаг 3: Подождите распространения DNS

- DNS изменения могут занять до 24 часов
- Обычно изменения применяются в течение 1-2 часов
- Проверить статус можно через сервисы типа `whatsmydns.net`

### Шаг 4: SSL сертификат

- TimeWeb автоматически выпустит SSL сертификат для вашего домена
- После выпуска сертификата сайт будет доступен по https://

## Полезные команды

```bash
# Локальная разработка
npm run dev

# Сборка для продакшена
npm run build

# Предпросмотр продакшен сборки
npm run preview

# Линтинг кода
npm run lint

# Очистка кэша (если нужно)
rm -rf node_modules
npm ci
```

## Мониторинг и метрики

В панели TimeWeb Cloud Apps доступны:

- **Логи деплоя** - детальная информация о каждой сборке
- **Логи приложения** - runtime логи (если есть)
- **Метрики**:
  - Количество запросов
  - Используемый трафик
  - Время отклика
  - Ошибки сервера

## Автообновление

После успешного первого деплоя:

1. **Автоматический деплой** запустится при каждом commit в выбранную ветку
2. **Отключение автодеплоя**:
   - Зайдите в настройки приложения
   - Отключите опцию "Автодеплой"
3. **Ручной деплой**:
   - Можно запустить в любое время через панель управления
   - Полезно для проверки изменений до merge

## Масштабирование

Базовая конфигурация включает:
- 1 ГБ NVMe диска
- 200,000 запросов в месяц

При необходимости можно:
- Увеличить лимиты
- Добавить больше ресурсов
- Подключить CDN

## Поддержка

При возникновении проблем:

### 1. Проверьте самостоятельно
- Логи сборки в панели TimeWeb Cloud Apps
- Локальная сборка `npm run build`
- Версия Node.js (должна быть 18.x)

### 2. Документация
- [TimeWeb Cloud Apps Docs](https://timeweb.cloud/docs/apps)
- [Пример React приложения](https://github.com/timeweb-cloud/app-example-react)

### 3. Обратитесь в поддержку
- Email: support@timeweb.com
- Тикет-система в панели управления
- Telegram-чат сообщества TimeWeb

## Чеклист перед деплоем

- [ ] Код собирается локально без ошибок
- [ ] Файл app.yml удалён (не нужен для TimeWeb)
- [ ] Все зависимости указаны в package.json
- [ ] Тип приложения в TimeWeb - "React" или "Other JS"
- [ ] Директория сборки указана как "dist"
- [ ] Команда сборки: `npm ci && npm run build`
- [ ] Проверена работа приложения через `npm run preview`
- [ ] Настроен автодеплой (рекомендуется)

---

**Важно:** TimeWeb Cloud Apps постоянно развивается. Актуальную документацию см. на [timeweb.cloud/docs](https://timeweb.cloud/docs/apps)
